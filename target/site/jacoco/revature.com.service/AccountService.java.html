<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AccountService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">project0</a> &gt; <a href="index.source.html" class="el_package">revature.com.service</a> &gt; <span class="el_source">AccountService.java</span></div><h1>AccountService.java</h1><pre class="source lang-java linenums">package revature.com.service;

import java.util.List;

import org.apache.log4j.Logger;

import revature.com.dao.AccountDao;
import revature.com.dao.AccountDaoInterface;
import revature.com.dao.UserDao;
import revature.com.dao.UserDaoInterface;
import revature.com.exceptions.InsufficientBalanceException;
import revature.com.exceptions.InvalidAmountOfMoneyException;
import revature.com.exceptions.NoAccountsExistException;
import revature.com.models.Account;
import revature.com.models.User;

<span class="nc" id="L17">public class AccountService {</span>

<span class="nc" id="L19">	private AccountDaoInterface adao = new AccountDao();</span>
<span class="nc" id="L20">	private UserDaoInterface udao = new UserDao();</span>
	
	//Log4j
<span class="nc" id="L23">	Logger logger = Logger.getLogger(AccountService.class);</span>
	

	public void viewAllAccounts() {
		
<span class="nc" id="L28">		logger.info(&quot;Fetching accounts...&quot;);</span>
		
<span class="nc" id="L30">		List&lt;Account&gt; accList = adao.findAll();</span>
<span class="nc bnc" id="L31" title="All 2 branches missed.">		if (accList.isEmpty()) {</span>
<span class="nc" id="L32">			throw new NoAccountsExistException(&quot;No accounts found!&quot;);</span>
		}
<span class="nc bnc" id="L34" title="All 2 branches missed.">		for (Account a : accList) {</span>
<span class="nc" id="L35">			System.out.println(a);</span>
		}
<span class="nc" id="L37">	}</span>

	public void viewOwnerAccListById(int userId) {
<span class="nc" id="L40">		List&lt;Account&gt; accList = adao.findByOwner(userId);</span>
<span class="nc bnc" id="L41" title="All 2 branches missed.">		if (accList.isEmpty()) {</span>
<span class="nc" id="L42">			throw new NoAccountsExistException(&quot;No accounts found!&quot;);</span>
		}
<span class="nc bnc" id="L44" title="All 2 branches missed.">		for (Account a : accList) {</span>
<span class="nc" id="L45">			System.out.println(a);</span>
		}

<span class="nc" id="L48">	}</span>

	// Withdraws amount from account using account id
	public double withdraw(double amount, int id, int custId) {

<span class="nc" id="L53">		Account a = adao.findById(id);</span>

		// Get the user ID to match it
<span class="nc" id="L56">		User u = udao.findById(custId);</span>

<span class="nc bnc" id="L58" title="All 2 branches missed.">		if (u != null) {</span>
<span class="nc bnc" id="L59" title="All 2 branches missed.">			if (u.getId() != a.getUsers_a_id()) {</span>
<span class="nc" id="L60">				throw new NoAccountsExistException(&quot;No such accounts with this id = &quot; + id); // this is for the user's Account list only not all accounts in the bank</span>
			}
		}
<span class="nc bnc" id="L63" title="All 2 branches missed.">		if (amount &lt;= 0) {</span>
<span class="nc" id="L64">			throw new InvalidAmountOfMoneyException(&quot;Amount to withdraw must be greater than 0 $&quot;);</span>
		}
<span class="nc bnc" id="L66" title="All 2 branches missed.">		if (amount &gt; a.getBalance()) {</span>
<span class="nc" id="L67">			throw new InsufficientBalanceException(&quot;Sorry, insufficient funds in your account&quot;);</span>
		}

		// If all of the above pass, then balance will be updated.
<span class="nc" id="L71">		double newBalance = a.getBalance() - amount;</span>

<span class="nc" id="L73">		adao.updateBalanceById(newBalance, id);</span>

<span class="nc" id="L75">		return newBalance;</span>

	}

	// Deposit amount to account using id
	public double deposit(double amount, int id, int custId) {
		
<span class="nc" id="L82">		Account a = adao.findById(id);</span>
		
		// Get the user ID to match it
<span class="nc" id="L85">		User u = udao.findById(custId);</span>
		
<span class="nc bnc" id="L87" title="All 2 branches missed.">		if (u != null) {</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">			if (u.getId() != a.getUsers_a_id()) {</span>
<span class="nc" id="L89">				throw new NoAccountsExistException(&quot;No such accounts with this id = &quot; + id); // this is for the user's Account list only not all accounts in the bank</span>
			}
		}
<span class="nc bnc" id="L92" title="All 2 branches missed.">		if (amount &lt;= 0) {</span>
<span class="nc" id="L93">			throw new InvalidAmountOfMoneyException(&quot;Amount to deposit must be greater than 0 $&quot;);</span>
		}

		// If all of the above pass, then balance will be updated.
<span class="nc" id="L97">		double newBalance = a.getBalance() + amount;</span>

<span class="nc" id="L99">		adao.updateBalanceById(newBalance, id);</span>

<span class="nc" id="L101">		return newBalance;</span>

	}

	public void transfer(double amount, int accFrom, int accTo, int custId) {
		
<span class="nc" id="L107">		Account aFrom = adao.findById(accFrom);</span>
<span class="nc" id="L108">		Account aTo = adao.findById(accTo);</span>

<span class="nc" id="L110">		User u = udao.findById(custId);</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">		if (u != null) {</span>
<span class="nc bnc" id="L112" title="All 4 branches missed.">			if (u.getId() != aFrom.getUsers_a_id() || u.getId() != aTo.getUsers_a_id()) {</span>
<span class="nc" id="L113">				throw new NoAccountsExistException(&quot;No such account(s) with with the provided id(s)&quot;); // this is for the user's Account list only not all accounts in the bank</span>
			}
		}
<span class="nc bnc" id="L116" title="All 2 branches missed.">		if (amount &lt;= 0) {</span>
<span class="nc" id="L117">			throw new InvalidAmountOfMoneyException(&quot;Amount to transfer must be greater than 0 $&quot;);</span>
		}
<span class="nc bnc" id="L119" title="All 2 branches missed.">		if (amount &gt; aFrom.getBalance()) {</span>
<span class="nc" id="L120">			throw new InsufficientBalanceException(&quot;Sorry, insufficient funds in your account&quot;);</span>
		}
		
		// If all of the above pass, then balances in both accounts will be updated.
				//TRANSFER FROM
<span class="nc" id="L125">				double newBalanceFrom = aFrom.getBalance() - amount;</span>
<span class="nc" id="L126">				adao.updateBalanceById(newBalanceFrom, accFrom);</span>
				//TO
<span class="nc" id="L128">				double newBalanceTo = aTo.getBalance() + amount;</span>
<span class="nc" id="L129">				adao.updateBalanceById(newBalanceTo, accTo);</span>
		
<span class="nc" id="L131">	}</span>
	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>